<form [formGroup]="alarmsCountConfigForm" fxLayout="column">

    <div style="width: 100%;">{{specifyInterval |json}}
        <mat-checkbox [checked]="specifyInterval" formControlName="specifyInterval"
            (change)="checkSpecifyInterval($event)">{{'tb.rulenode.specify-interval'|translate}}</mat-checkbox>
    </div>             
   
    <tb-timeinterval 
                predefinedName="timewindow.realtime" 
                formControlName="latestInterval"
                subscriptSizing="dynamic"
            style="padding-top: 8px">
    </tb-timeinterval>

    <div>
        <tb-output-message-type-autocomplete required formControlName="outMsgType">

        </tb-output-message-type-autocomplete>
    </div>
    <br>

    <div>
        <mat-checkbox formControlName="countAlarmsForPropagationEntities">
            tb.rulenode.count-alarms-for-propagation-entities
        </mat-checkbox>
    </div>
    <br>

    <div class="tb-hint" translate>
        tb.rulenode.propagation-entity-types
    </div>

    <br>
    <div fxFlex *ngIf="alarmsCountConfigForm.get('countAlarmsForPropagationEntities')?.value">
        <label class="tb-title no-padding">
            tb.rulenode.propagation-entity-types
        </label>

        <tb-entity-type-list fxFlex formControlName="propagationEntityTypes"
            [allowedEntityTypes]="propagationEntityTypes" [ignoreAuthorityFilter]="true">
        </tb-entity-type-list>

        <div class="tb-hint" translate>
            tb.rulenode.propagation-entity-types-info
        </div>
    </div>
    <br>

    <div>
        <tb-queue-autocomplete [queueType]="'TB_RULE_ENGINE'" formControlName="queueName">
        </tb-queue-autocomplete>
    </div>
    <br>

    <mat-expansion-panel [expanded]="true">
        <mat-expansion-panel-header>
            <mat-panel-title translate>tb.rulenode.alarms-count-mappings</mat-panel-title>
        </mat-expansion-panel-header>

        <ng-template matExpansionPanelContent>
            <ng-container formArrayName="alarmsCountMappings"
                style="padding: 10px; border-radius: 5px; margin-top: 10px; overflow-x: hidden"
                *ngFor="let map of alarmsCountConfigForm.get('alarmsCountMappings')['controls']; let k = index;">
                <div style="flex-direction: row; box-sizing: border-box; display: flex; place-content: center flex-start; align-items: center; flex: 1 1 0%;">
                    Count ({{ map.get('statusList').value ? map.get('statusList').value : 'All alarms' }} and  
                    {{ map.get('severityList').value }} and {{ map.get('typesList').value }})-&gt; {{ map.get('target').value }}

                    <button mat-icon-button color="primary" style="min-width: 40px;" type="button"
                            (click)="editMapping(k, map)">
                            <mat-icon>edit</mat-icon>
                        </button>
                        <button mat-icon-button color="primary" style="min-width: 40px;" type="button"
                            (click)="removeMapping(k)">
                            <mat-icon>close</mat-icon>
                        </button>
                </div>
                <!-- <div [formGroupName]="k">
                    <div style="display: flex; flex-direction: row;"><br>
                        <mat-form-field style="margin-right: 2px;">
                            <textarea formControlName="statusList"> Count [{{ map.get('statusList').value }} and </textarea>
                        </mat-form-field>
                        <mat-form-field style="margin-right: 2px;">
                            <textarea formControlName="severityList">{{ map.get('severityList').value }} and </textarea>
                        </mat-form-field>
                        <mat-form-field style="margin-right: 2px;">
                            <textarea formControlName="typesList"> {{ map.get('typesList').value }}]-&gt;</textarea>
                        </mat-form-field>
                        <mat-form-field style="margin-right: 2px;">
                            <textarea formControlName="target">{{ map.get('target').value }}</textarea>
                        </mat-form-field>
                        <button mat-icon-button color="primary" style="min-width: 40px;" type="button"
                            (click)="editMapping(k)">
                            <mat-icon>edit</mat-icon>
                        </button>
                        <button mat-icon-button color="primary" style="min-width: 40px;" type="button"
                            (click)="removeMapping(k)">
                            <mat-icon>close</mat-icon>
                        </button>
                    </div>
                </div> -->
            </ng-container>
        </ng-template>
        <div>
            <button mat-button (click)="openDialog()">Add</button>
        </div>
    </mat-expansion-panel>

</form>


